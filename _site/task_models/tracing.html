<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Tracing - Robot Teleoperation Platform</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Tracing | Robot Teleoperation Platform</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Tracing" /> <meta property="og:locale" content="en_US" /> <link rel="canonical" href="http://localhost:4000/task_models/tracing.html" /> <meta property="og:url" content="http://localhost:4000/task_models/tracing.html" /> <meta property="og:site_name" content="Robot Teleoperation Platform" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Tracing" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","headline":"Tracing","url":"http://localhost:4000/task_models/tracing.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> Robot Teleoperation Platform </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/" class="nav-list-link">Overview</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/task_models/" class="nav-list-link">Task Models</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/task_models/robot_models.html" class="nav-list-link">Robot Arms</a></li><li class="nav-list-item active"><a href="http://localhost:4000/task_models/tracing.html" class="nav-list-link active">Tracing</a></li><li class="nav-list-item "><a href="http://localhost:4000/task_models/box_and_block.html" class="nav-list-link">Box and Block</a></li><li class="nav-list-item "><a href="http://localhost:4000/task_models/arat.html" class="nav-list-link">ARAT</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/behind_the_scenes/" class="nav-list-link">Behind the Scenes</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/behind_the_scenes/installation.html" class="nav-list-link">Installation</a></li><li class="nav-list-item "><a href="http://localhost:4000/behind_the_scenes/build_settings.html" class="nav-list-link">Build Settings</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/behind_the_scenes/components/" class="nav-list-link">Components</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/behind_the_scenes/components/end_effectors.html" class="nav-list-link">End Effectors</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/behind_the_scenes/components/feedback_devices.html" class="nav-list-link">Feedback Devices</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/behind_the_scenes/components/ik_plugins.html" class="nav-list-link">IK Plugins</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/behind_the_scenes/components/input_devices.html" class="nav-list-link">Input Devices</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/behind_the_scenes/components/inspection_camera.html" class="nav-list-link">Inspection Camera</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/behind_the_scenes/components/surface_painting.html" class="nav-list-link">Painting</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/behind_the_scenes/components/rectangle_packing.html" class="nav-list-link">Rectangle Packing</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/behind_the_scenes/components/sticky_gripper.html" class="nav-list-link">Sticky Gripper</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/behind_the_scenes/components/tracker.html" class="nav-list-link">Tracker</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/behind_the_scenes/modified_components/" class="nav-list-link">Modified Components</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/behind_the_scenes/modified_components/urdf_importer.html" class="nav-list-link">URDF Importer</a> </li></ul></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/modification_workflow/" class="nav-list-link">Modification Workflow</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/modification_workflow/new_robot.html" class="nav-list-link">New Robot</a></li><li class="nav-list-item "><a href="http://localhost:4000/modification_workflow/new_task.html" class="nav-list-link">New Task</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Robot Teleoperation Platform" aria-label="Search Robot Teleoperation Platform" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/task_models/">Task Models</a></li> <li class="breadcrumb-nav-list-item"><span>Tracing</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="tracing"> <a href="#tracing" class="anchor-heading" aria-labelledby="tracing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tracing </h1> <p>Another manipulability benchmark that we considered fundamental was controlled, precise surface interaction. The ability to interact within a constrained task space that affords fewer dimensions than the input device is common in a wide range of applications, including sanding, painting, and composite lay-up. Additionally, tracing tests have been effectively used to asses human dexterity as well as teleoperation dexterity. To objectively measure the quality of the trace, we look at the number of pixels that are correctly painted in and compare that to the number of pixels that are incorrectly painted in. This score can vary significantly depending on brush stroke size and target image resolution, but can be used to consistently compare two different control configurations with the same tracing parameters.</p> <p><img src="/assets/imgs/Tracing.png" alt="Tracing" /></p> <h1 id="technical-details"> <a href="#technical-details" class="anchor-heading" aria-labelledby="technical-details"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details </h1> <p>The tracing task is enabled by two components, a <code class="language-plaintext highlighter-rouge">Marker</code> end-effector and a <code class="language-plaintext highlighter-rouge">DrawableMesh</code> canvas. For details on how this was created, see the <a href="/behind_the_scenes/components/surface_painting.html">Painting</a> component page. In addition to the painting component, there is also a scoring metric contained in the <code class="language-plaintext highlighter-rouge">SurfacePaintingSubTask</code> component. This metric uses a source image (the cursive “lab” in the above figure) and generates a score map. When evaluating the user’s performance, marker overlay is compared against the score map and the user recieves either positive or negative points for each pixel they have marked. To efficiently compute this, the score map is generated and then used in the context of a Unity <a href="https://docs.unity3d.com/Manual/class-ComputeShader.html">Compute Shader</a>, which enables general purpose GPU computation.</p> <p>At design time, the Signed Distance Field of the binary image is generated using the <a href="https://catlikecoding.com/sdf-toolkit/docs/texture-generator/">SDF-Toolkit (Free)</a> Unity Plugin.</p> <div class="table-wrapper"><table> <tbody> <tr> <td>Original Stencil</td> <td>SDF (Whiter is Closer)</td> </tr> <tr> <td><img src="/assets/imgs/lab_curve 1.png" alt="Stencil" /></td> <td><img src="/assets/imgs/2022-05-16-10-42-45.png" alt="SDF" /></td> </tr> </tbody> </table></div> <p>Then, the value of a mark is accumulated by multiplying the alpha channel of the mark with the score for that particular pixel generated from the SDF. SDF values equal to 0 have a score multiplier of 1, while SDF values greater than 0 have a negative score multiplier that scales with distance to the curve.</p> <p>The <code class="language-plaintext highlighter-rouge">TracingSubTask</code> component contains definitions for <code class="language-plaintext highlighter-rouge">ParallelScorer</code> and <code class="language-plaintext highlighter-rouge">ParallelSum</code> objects. Each rely on the <code class="language-plaintext highlighter-rouge">ScoreTracing.compute</code> shader definition, each of which manage the memory allocation for their respective GPU kernels.</p> <h2 id="parallelscorer"> <a href="#parallelscorer" class="anchor-heading" aria-labelledby="parallelscorer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">ParallelScorer</code> </h2> <p>This object implements slightly modified component-wise matrix multiplication. The alpha channel of the <code class="language-plaintext highlighter-rouge">Texture2D</code> <code class="language-plaintext highlighter-rouge">ScoreMap</code> holds the SDF for the curve, which is mapped to a score multiplier via a simple scoring function.</p> <figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">void</span> <span class="nf">Score</span><span class="p">(</span><span class="kt">uint</span> <span class="n">id</span><span class="p">:</span> <span class="n">SV_DispatchThreadID</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">uint2</span> <span class="n">xy</span> <span class="p">=</span> <span class="nf">uint2</span><span class="p">(</span><span class="n">id</span> <span class="p">/</span> <span class="n">res_y</span><span class="p">,</span> <span class="n">id</span> <span class="p">%</span> <span class="n">res_x</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">a</span> <span class="p">=</span> <span class="n">ScoreMap</span><span class="p">[</span><span class="n">xy</span><span class="p">][</span><span class="m">3</span><span class="p">];</span>
    <span class="kt">float</span> <span class="n">score</span> <span class="p">=</span> <span class="n">a</span> <span class="p">&gt;</span> <span class="m">0.99</span> <span class="p">?</span> <span class="m">1</span> <span class="p">:</span> <span class="n">a</span><span class="p">-</span><span class="m">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="p">&lt;</span> <span class="n">res_x</span> <span class="p">*</span> <span class="n">res_y</span><span class="p">)</span> <span class="n">Result</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="p">=</span> <span class="n">score</span> <span class="p">*</span> <span class="n">Marking</span><span class="p">[</span><span class="n">xy</span><span class="p">][</span><span class="m">3</span><span class="p">];</span>
<span class="p">}</span></code></pre></figure> <h2 id="parallelsummer"> <a href="#parallelsummer" class="anchor-heading" aria-labelledby="parallelsummer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">ParallelSummer</code> </h2> <p>This object implements a standard parallel sum reduction, and is used to accumulate the results of the <code class="language-plaintext highlighter-rouge">ParallelScorer</code>. The included shader and scoring function is an implementation of the Blelloch modification to the <a href="https://people.cs.pitt.edu/~bmills/docs/teaching/cs1645/lecture_scan.pdf">Hillis and Steele</a> parallel scan operation, except without the down sweep operation.</p> <figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="n">groupshared</span> <span class="kt">float</span> <span class="n">bucket</span><span class="p">[</span><span class="n">THREADS_PER_GROUP</span><span class="p">];</span>
<span class="k">void</span> <span class="nf">Scan</span><span class="p">(</span><span class="kt">uint</span> <span class="n">id</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">gi</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">gnumber</span><span class="p">,</span> <span class="kt">float</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">bucket</span><span class="p">[</span><span class="n">gi</span><span class="p">]</span> <span class="p">=</span> <span class="n">x</span><span class="p">;</span>
    
    <span class="p">[</span><span class="n">unroll</span><span class="p">]</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">t</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span> <span class="n">t</span> <span class="p">&lt;</span> <span class="n">THREADS_PER_GROUP</span><span class="p">;</span> <span class="n">t</span> <span class="p">&lt;&lt;=</span> <span class="m">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">GroupMemoryBarrierWithGroupSync</span><span class="p">();</span>
        <span class="kt">float</span> <span class="n">temp</span> <span class="p">=</span> <span class="n">bucket</span><span class="p">[</span><span class="n">gi</span><span class="p">];</span>
        <span class="kt">uint</span> <span class="n">right_index</span> <span class="p">=</span> <span class="n">gi</span> <span class="p">+</span> <span class="n">t</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">right_index</span> <span class="p">&lt;</span> <span class="n">THREADS_PER_GROUP</span><span class="p">)</span> <span class="n">temp</span> <span class="p">+=</span> <span class="n">bucket</span><span class="p">[</span><span class="n">right_index</span><span class="p">];</span>
        <span class="nf">GroupMemoryBarrierWithGroupSync</span><span class="p">();</span>
        <span class="n">bucket</span><span class="p">[</span><span class="n">gi</span><span class="p">]</span> <span class="p">=</span> <span class="n">temp</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">gi</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="n">OutputBuf</span><span class="p">[</span><span class="n">gnumber</span><span class="p">]</span> <span class="p">=</span> <span class="n">bucket</span><span class="p">[</span><span class="n">gi</span><span class="p">];</span>
<span class="p">}</span>


<span class="kt">uint</span> <span class="n">length</span><span class="p">;</span>
<span class="cp">#pragma kernel Sum
</span><span class="p">[</span><span class="nf">numthreads</span><span class="p">(</span><span class="n">THREADS_PER_GROUP</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">)]</span>
<span class="k">void</span> <span class="nf">Sum</span><span class="p">(</span><span class="kt">uint</span> <span class="n">id</span><span class="p">:</span> <span class="n">SV_DispatchThreadID</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">gid</span> <span class="p">:</span> <span class="n">SV_GroupIndex</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">gnumber</span> <span class="p">:</span> <span class="n">SV_GroupID</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">float</span> <span class="n">x</span> <span class="p">=</span> <span class="n">id</span> <span class="p">&lt;</span> <span class="n">length</span> <span class="p">?</span> <span class="n">InputBuf</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="p">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="nf">Scan</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">gnumber</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure> <p>One invokation of the above Sum reduction call will produce a new array with the length reduced by a factor of <code class="language-plaintext highlighter-rouge">THREADS_PER_GROUP</code>. Using a typical value of 512, it is necessary to call this function multiple times in a row (3-4, usually) to accumulate the total result.</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
