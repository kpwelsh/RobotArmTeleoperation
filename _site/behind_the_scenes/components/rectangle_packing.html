<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Rectangle Packing - Robot Teleoperation Platform</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Rectangle Packing | Robot Teleoperation Platform</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Rectangle Packing" /> <meta property="og:locale" content="en_US" /> <link rel="canonical" href="http://localhost:4000/behind_the_scenes/components/rectangle_packing.html" /> <meta property="og:url" content="http://localhost:4000/behind_the_scenes/components/rectangle_packing.html" /> <meta property="og:site_name" content="Robot Teleoperation Platform" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Rectangle Packing" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","headline":"Rectangle Packing","url":"http://localhost:4000/behind_the_scenes/components/rectangle_packing.html"}</script> <!-- End Jekyll SEO tag --> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "AMS" } } }); </script> <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"> </script> <script type="text/javascript" src="https://unpkg.com/mermaid@8.0.0-rc.8/dist/mermaid.min.js"> </script> <script> document.addEventListener('DOMContentLoaded', function() { mermaid.initialize({ theme: 'neutral' }); }, false); </script> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> Robot Teleoperation Platform </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/" class="nav-list-link">Overview</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/task_models/" class="nav-list-link">Task Models</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/task_models/robot_models.html" class="nav-list-link">Robot Arms</a></li><li class="nav-list-item "><a href="http://localhost:4000/task_models/tracing.html" class="nav-list-link">Tracing</a></li><li class="nav-list-item "><a href="http://localhost:4000/task_models/box_and_block.html" class="nav-list-link">Box and Block</a></li><li class="nav-list-item "><a href="http://localhost:4000/task_models/arat.html" class="nav-list-link">ARAT</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/behind_the_scenes/" class="nav-list-link">Behind the Scenes</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/behind_the_scenes/installation.html" class="nav-list-link">Installation</a></li><li class="nav-list-item "><a href="http://localhost:4000/behind_the_scenes/build_settings.html" class="nav-list-link">Build Settings</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/behind_the_scenes/components/" class="nav-list-link">Components</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/behind_the_scenes/components/end_effectors.html" class="nav-list-link">End Effectors</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/behind_the_scenes/components/feedback_devices.html" class="nav-list-link">Feedback Devices</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/behind_the_scenes/components/ik_plugins.html" class="nav-list-link">IK Plugins</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/behind_the_scenes/components/input_devices.html" class="nav-list-link">Input Devices</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/behind_the_scenes/components/inspection_camera.html" class="nav-list-link">Inspection Camera</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/behind_the_scenes/components/surface_painting.html" class="nav-list-link">Painting</a> </li><li class="nav-list-item active"> <a href="http://localhost:4000/behind_the_scenes/components/rectangle_packing.html" class="nav-list-link active">Rectangle Packing</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/behind_the_scenes/components/sticky_gripper.html" class="nav-list-link">Sticky Gripper</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/behind_the_scenes/components/tracker.html" class="nav-list-link">Tracker</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/behind_the_scenes/modified_components/" class="nav-list-link">Modified Components</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/behind_the_scenes/modified_components/urdf_importer.html" class="nav-list-link">URDF Importer</a> </li></ul></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/modification_workflow/" class="nav-list-link">Modification Workflow</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/modification_workflow/new_robot.html" class="nav-list-link">New Robot</a></li><li class="nav-list-item "><a href="http://localhost:4000/modification_workflow/new_task.html" class="nav-list-link">New Task</a></li><li class="nav-list-item "><a href="http://localhost:4000/modification_workflow/data_logging.html" class="nav-list-link">Data Logging</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Robot Teleoperation Platform" aria-label="Search Robot Teleoperation Platform" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/behind_the_scenes/">Behind the Scenes</a></li> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/behind_the_scenes/components/">Components</a></li> <li class="breadcrumb-nav-list-item"><span>Rectangle Packing</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="usage"> <a href="#usage" class="anchor-heading" aria-labelledby="usage"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Usage </h1> <p>The <code class="language-plaintext highlighter-rouge">RectanglePacking</code> class in the <code class="language-plaintext highlighter-rouge">Utils</code> namespace provides a simple method for arranging a list of rectangles within a larger rectanlge. This is not a particularly efficient algorithm, so it is recommended to generate a single <code class="language-plaintext highlighter-rouge">RectangleArrangement</code> for a give configuration and reuse it.</p> <p>To generate an arrangement, all you need to do it call <code class="language-plaintext highlighter-rouge">RectanglePacking.arrangeRectangles</code> with a list of dimensions of the rectangles and a desired collage aspect ratio. You will then receive a <code class="language-plaintext highlighter-rouge">RectangleArrangement</code> struct that contains the total size of the arrangement (in the same units used to specify the original rectangles) and the absolute positions of each rectangle. Optionally, you can specify the horizontal and vertical justification to determine the placement when empty space is unavoidable.</p> <figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">RectangleArrangement</span> <span class="p">{</span>
    <span class="k">public</span> <span class="n">Vector2</span> <span class="n">dimensions</span><span class="p">;</span>
    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;(</span><span class="n">Vector2</span><span class="p">,</span> <span class="n">Vector2</span><span class="p">)&gt;</span> <span class="n">children</span><span class="p">;</span> <span class="c1">// Top-left and bottom-right coordinates of the arranged rectangle</span>

    <span class="k">public</span> <span class="kt">float</span> <span class="nf">fillRatio</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">children</span><span class="p">.</span><span class="nf">Sum</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Item2</span><span class="p">.</span><span class="n">x</span> <span class="p">*</span> <span class="n">x</span><span class="p">.</span><span class="n">Item2</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="p">/</span> <span class="p">(</span><span class="n">dimensions</span><span class="p">.</span><span class="n">x</span> <span class="p">*</span> <span class="n">dimensions</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure> <p>The list of rectangles has the same length of the list provided, and each return rectangle represents the placement position of the input rectangle at the same index.</p> <h1 id="techincal-details"> <a href="#techincal-details" class="anchor-heading" aria-labelledby="techincal-details"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Techincal Details </h1> <p>Generating an optimal <a href="https://en.wikipedia.org/wiki/Rectangle_packing">rectangle packing</a> is in general an NP-hard problem. The algorithm implemented here scales very poorly, and in practice becomes impractical after ~30 rectangles. To make it manageable, several assumptions are made:</p> <ol> <li>Rectangles cannot be rotated.</li> <li>Rectangles cannot be scaled.</li> <li>The order in which the rectangles are provided is the order in which they should appead (from top-left to bottom-right).</li> </ol> <p>With these assumptions, it seeks to break the input list into rows that result in the “best packed” configuration, as measured by the fraction of unfilled space in the resulting arrangement. With this goal, it simply tries all of the allowed configurations and chooses the best one.</p> <figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">static</span> <span class="n">RectangleArrangement</span> <span class="nf">Arrange</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">Vector2</span><span class="p">&gt;</span> <span class="n">rectangles</span><span class="p">,</span> <span class="kt">float</span> <span class="n">outAspect</span><span class="p">,</span>
                                                <span class="kt">int</span> <span class="n">rows</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cols</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">,</span>
                                                <span class="n">Justification</span> <span class="n">hJustification</span> <span class="p">=</span> <span class="n">Justification</span><span class="p">.</span><span class="n">Left</span><span class="p">,</span>
                                                <span class="n">Justification</span> <span class="n">vJustification</span> <span class="p">=</span> <span class="n">Justification</span><span class="p">.</span><span class="n">Left</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">float</span> <span class="n">bestRatio</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
    <span class="n">RectangleArrangement</span> <span class="n">bestArrangement</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
    <span class="c1">// Iterate over all of the possible combinations</span>
    <span class="c1">// Becuase of assumption 1,2, and 3, simply specifying the number of rectangles</span>
    <span class="c1">// uniquely specifies the arrangement.</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">rowSizes</span> <span class="k">in</span> <span class="nf">possibleRows</span><span class="p">(</span><span class="n">rectangles</span><span class="p">.</span><span class="n">Count</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// For each one, generate the specific rectangle arrangement</span>
        <span class="c1">// This computes the top left points as well as the width and height of each rectangle</span>
        <span class="c1">// as well as the dimensions of the minimum bounding rectangle</span>
        <span class="n">RectangleArrangement</span> <span class="n">arrangement</span> <span class="p">=</span> 
            <span class="nf">arrangeRectangles</span><span class="p">(</span>
                <span class="nf">placeRectangles</span><span class="p">(</span><span class="n">rowSizes</span><span class="p">,</span> <span class="n">rectangles</span><span class="p">),</span>
                <span class="n">outAspect</span><span class="p">,</span>
                <span class="n">hJustification</span><span class="p">,</span>
                <span class="n">vJustification</span>
        <span class="p">);</span>
        <span class="c1">// If this is a good fill ratio, then store it as the best</span>
        <span class="c1">// arrangement</span>
        <span class="kt">float</span> <span class="n">ratio</span> <span class="p">=</span> <span class="n">arrangement</span><span class="p">.</span><span class="nf">fillRatio</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ratio</span> <span class="p">&gt;</span> <span class="n">bestRatio</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">bestArrangement</span> <span class="p">=</span> <span class="n">arrangement</span><span class="p">;</span>
            <span class="n">bestRatio</span> <span class="p">=</span> <span class="n">ratio</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">bestArrangement</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
